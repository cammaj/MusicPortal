{% extends 'base.html' %}
{% block content %}
<div class="section-header">
  <div>
    <p class="eyebrow">Fan zone</p>
    <h2>Discover concerts</h2>
  </div>
</div>
<form method="get" class="glass filter-row">
  <label>Band
    <input type="text" name="band" value="{{ band_query }}" placeholder="Search by band name">
  </label>
  <label>Date
    <input type="date" name="date" value="{{ date_query }}">
  </label>
  <label>Status
    <select name="status">
      <option value="">Any</option>
      <option value="scheduled" {% if status_filter=='scheduled' %}selected{% endif %}>Scheduled</option>
      <option value="cancelled" {% if status_filter=='cancelled' %}selected{% endif %}>Cancelled</option>
      <option value="full" {% if status_filter=='full' %}selected{% endif %}>Fully booked</option>
    </select>
  </label>
  <button type="submit" class="button">Search</button>
</form>

<div class="card-grid">
  {% if concerts %}
    {% for concert in concerts %}
    <div class="concert-card">
      <div class="concert-meta">
        <span class="pill">{{ concert['status'] }}</span>
        <span class="pill soft">{{ concert['venue'] }}</span>
      </div>
      <h3>{{ concert['band_name'] }}</h3>
      <p class="muted">{{ concert['concert_datetime'] }}</p>
      <p class="muted">Cost: {{ concert['cost'] }}</p>
      {% if g.user and g.user['role'] == 'fan' %}
        {% if concert['id'] in selected_ids %}
          <form method="post" action="{{ url_for('remove_selected', concert_id=concert['id']) }}">
            <button class="button ghost" type="submit">Remove</button>
          </form>
        {% else %}
          <form method="post" action="{{ url_for('add_selected', concert_id=concert['id']) }}">
            <button class="button" type="submit">Add to Favorites</button>
          </form>
        {% endif %}
      {% else %}
        <a class="button ghost" href="{{ url_for('login') }}">Login to save</a>
      {% endif %}
    </div>
    {% endfor %}
  {% else %}
    <div class="empty">No concerts found. Try adjusting your search.</div>
  {% endif %}
</div>
{% endblock %}
